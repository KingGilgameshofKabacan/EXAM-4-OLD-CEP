import React, { useState, useEffect } from 'react';
import { ChevronLeft, ChevronRight, Check, X, Menu, Play, FileText, CheckCircle, AlertCircle, RefreshCw, Home } from 'lucide-react';

// --- DATA: All 72 Questions Transcribed and Mapped ---
const sit1 = "Situation 1: A beam 3 m long is simply supported at its ends. The beam is loaded with a downward vertical load of 200 N at a point 2 m from the left support.";
const sit2 = "Situation 2: A continuous beam has two spans, the left span being 4 m long and the right span is 6 m long. The beam is restrained at the left most support, hinged at the interior support, and roller at the rightmost support. The beam carries a concentrated load of 40 kN at the middle of the 4-m span and a uniform load of 5 kN/m throughout the 6-m span.";
const sit3 = "Situation 3: A 600 mm x 600 mm column carries a total live load of 1200 kN and a total dead load of 1500 kN. The column is to be supported by a rectangular spread footing whose width is limited to 3 m and whose bottom is 2 m below the ground surface. Allowable soil bearing capacity at the base of the footing is 230 kPa. Unit weight of soil above footing is 16 kN/m³ and unit weight of concrete is 23.5 kN/m³. Assume f'c = 28 MPa and fy = 275 MPa.";
const sit4 = "Situation 4: A propped beam 6 m long carries a load that varies uniformly from 10 kN/m at the fixed end to zero at the simple support.";
const sit5 = "Situation 5: A place truss is loaded as shown. (Refer to original figure). 6 @ 10.50 m = 63 m total length. Loads: 1200 N at J (inclined 35 degrees), 480 N at D, 480 N at E.";
const sit6 = "Situation 6: The 300-Newton block as shown in the figure is at rest on the rough horizontal place before the force P is applied at t = 0. The force P = 80t, where P is in Newtons and t is in seconds.";
const sit7 = "Situation 7: Consider the force system as shown in the original figure.";
const sit8 = "Situation 8: The shear diagram of a beam is shown in the original figure.";
const sit9 = "Situation 9: A reinforced concrete T-beam has the following properties: Flange width, b = 1370 mm; Flange thickness, ty = 130 mm; Width of web, bw = 300 mm; Effective depth, d = 610 mm; As = 2950 mm²; fc = 28 MPa; fy = 414 MPa";
const sit10 = "Situation 10: Classify each of the trusses in the figure as stable, unstable, statically determinate, or statically indeterminate. The trusses are subjected to arbitrary external loadings that are assumed to be known and can act anywhere on the trusses.";
const sit11 = "Situation 11: For the truss shown on the figure, A (area) and E is the same for all the members.";
const sit12 = "Situation 12: A simply supported beam is acted upon by a concentrated load and a concentrated moment as shown in the figure. The product EI = 1,000,000 where E is the modulus of elasticity in pascals and I is the moment of inertia in meter to the fourth power. Analyze the beam using the Area-moment method.";
const sit13 = "Situation 13: A reinforced concrete rectangular beam has a width of 250 mm and an effective depth of 500 mm. The beam is required to carry an ultimate moment of 300 kN-m. It is required to design the steel reinforcement of the beam. Compression reinforcement, if necessary, will be placed at a depth of 75 mm from the extreme compression concrete. Assume fy = 275.8 MPa and f'c = 35 MPa.";
const sit14 = "Situation 14: A prestressed concrete beam 400 mm x 800 mm is to carry a uniform load of 40 kN/m on a simple span of 11 m. The beam is prestressed to 2200 kN applied 200 mm below the neutral axis.";
const sit15 = "Situation 15: According to Section 4.5.1.3.1 of NSCP, on gross section of axially loaded compression members whose cross-sections meet with the provisions of the code, when KL/r < Cc: Fa = [1 - (KL/r)² / (2Cc²)] (Fy / FS). FS = 5/3 + 3(KL/r) / (8Cc) - (KL/r)³ / (8Cc³). When KL/r exceeds Cc: Fa = 12π²E / (23(KL/r)²). A column 3 m long and pinned at both ends carries an axial load of 190 kN. Use A36 steel with Fy = 248 MPa and E = 200,000 MPa.";
const sit16 = "Situation 16: According to Section 5.3.3.2 of the NSCP, the nominal maximum size of coarse aggregates shall not be larger than: a) 1/5 narrowest dimension between forms, b) 1/3 depth of slabs, c) 3/4 minimum clear spacing between bars. Section 5.7.6: Minimum clear spacing between parallel bars in a layer shall be db, but not less than 25mm. (Refer to original beam section figure).";
const sit17 = "Situation 17: For the steel section shown in the original figure:";
const sit18 = "Situation 18: A riveted lap joint is shown in the figure. The rivets have 16 mm diameters, and the permissible stresses are 124 MPa for shear in rivets, 296 MPa for bearing, and 165 MPa for tension (on net area) in plates. The plates are 10 mm thick. Assume hole diameter be 1.5 mm larger than the rivet diameter.";

const quizData = [
  { id: 1, sit: sit1, q: "The maximum deflection is located at what distance from the left support?", opts: ["1.52 m", "1.63 m", "2.15 m", "2 m"], ans: 1 },
  { id: 2, sit: sit1, q: "Calculate the maximum deflection assuming E = 50 GPa and I = 1 x 10⁶ mm⁴.", opts: ["1.5 mm", "2.4 mm", "3.5 mm", "2.9 mm"], ans: 3 },
  { id: 3, sit: sit1, q: "Calculate the rotation of the beam at the right support.", opts: ["0.004444 radian", "0.00111 radian", "0.00333 radian", "0.00222 radian"], ans: 2 },
  { id: 4, sit: null, q: "A square tied column 400 mm on each side is reinforced with 8-25 mm bars with fy = 275 MPa. Assuming f'c = 22 MPa, determine the ultimate axial load capacity of this column in kN.", opts: ["3524", "2239", "1856", "3214"], ans: 1 },
  { id: 5, sit: null, q: "A round spiral column is to support an axial dead load of 800 kN and an axial live load of 1350 kN. Assuming that 2% longitudinal steel is desired, f'c = 27.6 MPa and fy = 414 MPa, the required column diameter is:", opts: ["470 mm", "450 mm", "550 mm", "320 mm"], ans: 0 },
  { id: 6, sit: null, q: "The steel ratio for a 9-mm diameter spiral reinforcement for a round column 600 mm in diameter with fy = 200 MPa and f'c = 30 MPa is: (assume concrete cover of 40 mm)", opts: ["0.022", "0.032", "0.036", "0.042"], ans: 0 },
  { id: 7, sit: null, q: "The water cement ratio in concrete is:", opts: ["The ratio of the volume of water to the weight of cement.", "The ratio of the volume of water to the volume of cement.", "The ratio of the weight of water to the weight of the cement.", "The ratio of the weight of water to the volume of cement."], ans: 2 },
  { id: 8, sit: null, q: "The most popular non-destructive test for concrete strength is a spring-loaded device, which derives a steel probe against a concrete surface... The test is known as:", opts: ["Pulse Velocity", "Rebound Hammer", "Penetration Resistance", "Pull-out"], ans: 1 },
  { id: 9, sit: null, q: "These are materials containing finely divided silica, maybe added to concrete to take advantage of these cements formed when silica reacts with free lime... substituting this for part of the cement can have advantage in mass concrete if the generation of heat needs to be reduced.", opts: ["Retardant", "Lime", "Pozzolan", "Plasticizer"], ans: 2 },
  { id: 10, sit: sit2, q: "Determine the moment at the restrained end in kN-m.", opts: ["-18.33", "-20.67", "-17.67", "-19.17"], ans: 3 },
  { id: 11, sit: sit2, q: "Determine the moment at the interior support in kN-m.", opts: ["-21.67", "-26.67", "-19.67", "-20.33"], ans: 0 },
  { id: 12, sit: sit2, q: "Determine the vertical reaction at the interior support in kN.", opts: ["42.5", "35.2", "39.23", "28.6"], ans: 2 },
  { id: 13, sit: sit3, q: "Assuming thickness of footing to be 700 mm, determine the effective soil bearing capacity of the soil in kPa.", opts: ["180.43", "192.75", "207.12", "186.55"], ans: 1 },
  { id: 14, sit: sit3, q: "Determine the required length of footing rounded-off to the nearest 0.1 m.", opts: ["3.8 m", "4.9 m", "4.7 m", "4.3 m"], ans: 2 },
  { id: 15, sit: sit3, q: "The required depth of footing based on wide beam shear is nearest to:", opts: ["503 mm", "521 mm", "465 mm", "577 mm"], ans: 3 },
  { id: 16, sit: sit3, q: "The required depth of footing based on punching shear is nearest to:", opts: ["547 mm", "514 mm", "591 mm", "602 mm"], ans: 0 },
  { id: 17, sit: sit3, q: "Determine the required number of 28-mm bars needed along the short direction of the footing.", opts: ["22", "20", "16", "18"], ans: 0 },
  { id: 18, sit: sit3, q: "Determine the required number of 28-mm bars needed along the long direction of the footing.", opts: ["18", "20", "288", "24"], ans: 3 },
  { id: 19, sit: null, q: "Design the span length for which the bending and the shear capacity for a 100 mm x 300 mm beam is reached simultaneously when the beam is loaded with a uniform load throughout the span. The allowable stresses in bending and shear are fb = 12.5 MPa and fv = 0.83 MPa.", opts: ["3.678 m", "4.518 m", "4.235 m", "4.984 m"], ans: 1 },
  { id: 20, sit: null, q: "A wooden log is to be used as a footbridge to span a gap. The log is required to support a concentrated load of 30 kN at midspan. If the allowable stress in shear is 0.7 MPa, what diameter of log that would be needed?", opts: ["191 mm", "270 mm", "94.4 mm", "135 mm"], ans: 0 },
  { id: 21, sit: null, q: "A cantilever beam 3 m long is subjected to a uniformly distributed load of 30 kN per meter of length. The allowable working stress in either tension or compression is 150 MPa. If the cross section is to be rectangular, determine the dimensions if the height is to be twice as great as the width.", opts: ["90 mm x 180 mm", "130 mm x 260 mm", "100 mm x 200 mm", "110 mm x 220 mm"], ans: 3 },
  { id: 22, sit: sit4, q: "Which of the following most nearly gives the vertical reaction at the simple support in kN.", opts: ["4", "7", "5", "6"], ans: 3 },
  { id: 23, sit: sit4, q: "Which of the following most nearly gives the moment at the fixed end in kN-m.", opts: ["-24", "-7", "-5", "-6"], ans: 0 },
  { id: 24, sit: sit4, q: "Which of the following most nearly gives the location of the maximum deflection measured from the simple support.", opts: ["2.68 m", "3.42 m", "4.12 m", "1.15 m"], ans: 0 },
  { id: 25, sit: sit5, q: "Which of the following most nearly gives the reaction at G, in Newtons.", opts: ["810", "760", "645", "920"], ans: 0 },
  { id: 26, sit: sit5, q: "Which of the following most nearly gives the bar force AH, in Newtons.", opts: ["810", "1900", "645", "2678"], ans: 3 },
  { id: 27, sit: sit5, q: "Which of the following most nearly gives the bar force JD, in Newtons.", opts: ["760", "810", "640", "920"], ans: 2 },
  { id: 28, sit: sit6, q: "Which of the following most nearly gives time, in seconds, when the block starts to slide.", opts: ["2.34", "2.25", "1.76", "3.21"], ans: 1 },
  { id: 29, sit: sit6, q: "Which of the following most nearly gives the velocity of the block, in meters per second, after five seconds.", opts: ["24.5", "12.1", "14.6", "18.3"], ans: 2 },
  { id: 30, sit: sit6, q: "Which of the following most nearly gives the distance traveled by the block, in meters per second, after five seconds.", opts: ["16.6", "12.2", "18.5", "10.8"], ans: 0 },
  { id: 31, sit: sit7, q: "Which of the following gives the y-component of P in kN.", opts: ["187.4", "113.8", "143.2", "121.9"], ans: 3 },
  { id: 32, sit: sit7, q: "Which of the following gives the z-component of P in kN.", opts: ["267.3", "243.8", "252.3", "198.9"], ans: 1 },
  { id: 33, sit: sit7, q: "Which of the following gives the angle that P makes with x-axis, in degrees.", opts: ["53.3", "43.2", "34.2", "67.5"], ans: 0 },
  { id: 34, sit: null, q: "A solid circular shaft is to be designed to carry torque of 750 N-m and a bending moment of 5000 N-m. Determine the diameter of the shaft without exceeding a shearing stress of 70 MPa and flexural stress of 120 MPa.", opts: ["75.3 mm", "73.5 mm", "71.5 mm", "72.1 mm"], ans: 0 },
  { id: 35, sit: null, q: "If the principal stresses on a body are f1 = 40 MPa, f2 = -70 MPa, and f3 = 60 MPa, what is the maximum shear stress?", opts: ["10 MPa", "20 MPa", "55 MPa", "65 MPa"], ans: 3 },
  { id: 36, sit: null, q: "An axial load 100 kN is applied to a flat bar 20 mm thick, tapering in width from 120 mm to 40 mm in a length of 10 m. Assume E = 200 GPa, determine the total elongation of the bar.", opts: ["3.43 mm", "2.125 mm", "4.33 mm", "1.985 mm"], ans: 0 },
  { id: 37, sit: sit8, q: "Which of the following most nearly gives the maximum positive moment?", opts: ["900 N-m", "480 N-m", "1800 N-m", "2700 N-m"], ans: 2 },
  { id: 38, sit: sit8, q: "Which of the following most nearly gives the maximum negative moment on the beam?", opts: ["1800 N-m", "480 N-m", "0 N-m", "-900 N-m"], ans: 1 },
  { id: 39, sit: sit8, q: "Which of the following most nearly gives the location of the point of infliction from the right end of the beam?", opts: ["0.36 m", "1.64 m", "6.32 m", "2.35 m"], ans: 3 },
  { id: 40, sit: sit9, q: "Which of the following most nearly gives the depth in mm of the compression block from the top of the beam.", opts: ["45.8", "37.5", "95.5", "115.4"], ans: 1 },
  { id: 41, sit: sit9, q: "Which of the following most nearly gives the total compressive force in concrete in kN.", opts: ["1380", "1840", "1220", "1540"], ans: 2 },
  { id: 42, sit: sit9, q: "Which of the following nearly gives the ultimate moment capacity of the section in kN-m.", opts: ["450", "750", "550", "650"], ans: 3 },
  { id: 43, sit: sit10, q: "The truss in figure Situation 8, 28.", opts: ["statically determinate", "statically indeterminate to the second degree", "statically indeterminate to the first degree", "internally unstable"], ans: 2 },
  { id: 44, sit: sit10, q: "The truss in figure Situation 8, 29.", opts: ["statically determinate", "statically indeterminate to the second degree", "statically indeterminate to the first degree", "internally unstable"], ans: 3 },
  { id: 45, sit: sit10, q: "The truss in figure situation 8, 30.", opts: ["statically determinate", "statically indeterminate to the second degree", "statically indeterminate to the first degree", "internally unstable"], ans: 0 },
  { id: 46, sit: sit11, q: "Which of the following most nearly gives the vertical reaction at B in kN.", opts: ["300", "350", "250", "450"], ans: 0 },
  { id: 47, sit: sit11, q: "Which of the following most nearly gives the total reaction at A in kN.", opts: ["550", "400", "650", "500"], ans: 3 },
  { id: 48, sit: sit11, q: "Which of the following most nearly gives the axial force in member AC in kN.", opts: ["432.5", "278.5", "324.1", "567.3"], ans: 2 },
  { id: 49, sit: sit12, q: "Which of the following most nearly gives the vertical deviation of point B relative to the tangent drawn at A in mm.", opts: ["1.97", "0.75", "3.86", "2.47"], ans: 0 },
  { id: 50, sit: sit12, q: "Which of the following most nearly gives the vertical deviation of point D relative to the tangent drawn at A in mm.", opts: ["0.72", "3.58", "2.73", "1.13"], ans: 3 },
  { id: 51, sit: sit12, q: "Which of the following most nearly gives the vertical deflection at D in mm.", opts: ["0.187", "0.342", "0.058", "0.275"], ans: 1 },
  { id: 52, sit: null, q: "A 10 m steel wide flange beam is laterally supported. The width of the web of the beam is 700 mm and web thickness is 10 mm. If fy is equal to 250 MPa, the allowable bending stress is:", opts: ["180 MPa", "150 MPa", "165 MPa", "200 MPa"], ans: 2 },
  { id: 53, sit: null, q: "The structural I-beam supporting floor carries a floor load of 4.6 kN/m². The beams span is 6.0 m and are simply supported at their ends. Determine the centerline spacing if the allowable stress in the beam is 120 MPa and the section modulus is 534 x 10³ mm³.", opts: ["3.75 m", "3.45 m", "4.0 m", "3.0 m"], ans: 3 },
  { id: 54, sit: null, q: "A BW 775 x 287 steel I beam has the following dimensions: H = 775 mm, tw = 19 mm, B = 360 mm, tf = 32 mm. The moment of inertia Ix about the principal axis as:", opts: ["375,086 cm⁴", "375,086 mm⁶", "375,086 mm⁴", "none in the list"], ans: 2 },
  { id: 55, sit: sit13, q: "Which of the following most nearly gives the maximum reinforcement ratio according to 1992 NSCP?", opts: ["0.045", "0.036", "0.015", "0.028"], ans: 0 },
  { id: 56, sit: sit13, q: "Which of the following most nearly gives the required tension steel area in square mm.", opts: ["3450", "2680", "3690", "3250"], ans: 1 },
  { id: 57, sit: sit13, q: "Using 25 mm diameter bar, which of the following gives the required number of bars for the beam.", opts: ["4", "8", "6", "7"], ans: 2 },
  { id: 58, sit: sit14, q: "Which of the following most nearly gives the stress at the bottom of the beam at midspan.", opts: ["-4 MPa", "-3 MPa", "-2 MPa", "-11 MPa"], ans: 1 },
  { id: 59, sit: sit14, q: "Which of the following most nearly gives the stress at the top of the beam at midspan.", opts: ["-11 MPa", "-3 MPa", "-4 MPa", "-2 MPa"], ans: 0 },
  { id: 60, sit: sit14, q: "If a concentrated load P is to be applied at midspan, which of the following most nearly gives the value of P so that the stress at the bottom of the beam at midspan is zero.", opts: ["52 kN", "24 kN", "36 kN", "47 kN"], ans: 3 },
  { id: 61, sit: sit15, q: "Which of the following sections gives the largest allowable compressive stress.", opts: ["2L 125 x 75 x 12", "2L 150 x 90 x 10", "2L 150 x 90 x 12", "Not enough data"], ans: 2 },
  { id: 62, sit: sit15, q: "Which of the following sections gives the smallest allowable compressive stress.", opts: ["2L 125 x 75 x 12", "2L 150 x 90 x 10", "2L 150 x 90 x 12", "Not enough data"], ans: 0 },
  { id: 63, sit: sit15, q: "Which of the following sections gives the most economical (lightest) section for the given load.", opts: ["2L 125 x 75 x 12", "2L 150 x 90 x 10", "2L 150 x 90 x 12", "Not enough data"], ans: 1 },
  { id: 64, sit: sit16, q: "Which of the following gives the clear spacing between the horizontal bars in mm.", opts: ["28", "18", "25", "23"], ans: 0 },
  { id: 65, sit: sit16, q: "Which of the following gives the narrowest possible dimension in mm (width) of the forms for the given bar arrangement.", opts: ["256", "261", "266", "261"], ans: 1 },
  { id: 66, sit: sit16, q: "Which of the following gives the maximum size in mm of coarse aggregates that may be used for the beam.", opts: ["16", "54", "36", "21"], ans: 3 },
  { id: 67, sit: sit17, q: "Which of the following most nearly gives the section modulus of the beam's section.", opts: ["4,900,000 mm³", "4,300,000 mm³", "3,400,000 mm³", "5,100,000 mm³"], ans: 1 },
  { id: 68, sit: sit17, q: "Which of the following most nearly gives the plastic section modulus of the beam's section.", opts: ["5,560,000 mm³", "5,120,000 mm³", "4,550,000 mm³", "6,130,000 mm³"], ans: 0 },
  { id: 69, sit: sit17, q: "Which of the following most nearly gives the shape factor of the section.", opts: ["1.8", "1.1", "1.3", "1.5"], ans: 2 },
  { id: 70, sit: sit18, q: "Which of the following gives the value of P so that the allowable bearing stress in rivets will not be exceeded.", opts: ["285.7 kN", "214.5 kN", "236.8 kN", "257.7 kN"], ans: 2 },
  { id: 71, sit: sit18, q: "Which of the following gives the value of P so that the allowable tensile stress in the plates will not be exceeded.", opts: ["302.5 kN", "254.8 kN", "298.3 kN", "280.5 kN"], ans: 3 },
  { id: 72, sit: sit18, q: "Which of the following gives the safe value of P.", opts: ["124.6 kN", "114.3 kN", "280.5 kN", "236.8 kN"], ans: 0 }
];


// --- REACT COMPONENT ---
export default function App() {
  const [mode, setMode] = useState('intro'); // 'intro', 'practice', 'exam', 'results'
  const [currentIdx, setCurrentIdx] = useState(0);
  const [answers, setAnswers] = useState(new Array(quizData.length).fill(null));
  const [sidebarOpen, setSidebarOpen] = useState(true);

  // Computed state
  const isPractice = mode === 'practice';
  const isExam = mode === 'exam';
  const currentQ = quizData[currentIdx];
  const totalQ = quizData.length;
  const answeredCount = answers.filter(a => a !== null).length;

  const handleStart = (selectedMode) => {
    setMode(selectedMode);
    setCurrentIdx(0);
    setAnswers(new Array(quizData.length).fill(null));
  };

  const handleOptionClick = (optIdx) => {
    if (isPractice && answers[currentIdx] !== null) return; // Prevent changing answer in practice mode

    const newAnswers = [...answers];
    newAnswers[currentIdx] = optIdx;
    setAnswers(newAnswers);
  };

  const submitExam = () => {
    if (window.confirm("Are you sure you want to finish and view your results?")) {
      setMode('results');
    }
  };

  const goHome = () => {
    if (window.confirm("Are you sure you want to return to the home screen? Your progress will be lost.")) {
      setMode('intro');
    }
  };

  // Intro Screen
  if (mode === 'intro') {
    return (
      <div className="min-h-screen bg-slate-100 flex items-center justify-center p-6 font-sans">
        <div className="max-w-2xl bg-white rounded-xl shadow-lg overflow-hidden border border-slate-200">
          <div className="bg-slate-800 p-8 text-center text-white">
            <h1 className="text-3xl font-bold tracking-tight mb-2">CEP 400B: Structural Analysis & Design</h1>
            <p className="text-slate-300">Fourth Examination Simulator</p>
          </div>
          <div className="p-8">
            <div className="flex items-center justify-center space-x-4 mb-8 text-slate-600">
              <div className="flex items-center"><FileText className="w-5 h-5 mr-2" /> 72 Questions</div>
              <div className="flex items-center"><CheckCircle className="w-5 h-5 mr-2" /> Multiple Choice</div>
            </div>
            
            <p className="text-slate-600 mb-8 text-center leading-relaxed">
              Select your preferred mode. <br/>
              <strong>Practice Mode</strong> reveals the correct answer immediately after you make a choice. <br/>
              <strong>Exam Mode</strong> hides all feedback until you submit the entire test.
            </p>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <button 
                onClick={() => handleStart('practice')}
                className="flex flex-col items-center p-6 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-xl transition-colors duration-200 text-blue-800"
              >
                <RefreshCw className="w-8 h-8 mb-3 text-blue-600" />
                <span className="font-semibold text-lg">Practice Mode</span>
                <span className="text-sm text-blue-600/80 mt-1">Instant Feedback</span>
              </button>
              
              <button 
                onClick={() => handleStart('exam')}
                className="flex flex-col items-center p-6 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-xl transition-colors duration-200 text-slate-800"
              >
                <Play className="w-8 h-8 mb-3 text-slate-600" />
                <span className="font-semibold text-lg">Exam Mode</span>
                <span className="text-sm text-slate-500 mt-1">Feedback at the end</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  // Results Screen
  if (mode === 'results') {
    const score = answers.filter((a, i) => a === quizData[i].ans).length;
    const percentage = Math.round((score / totalQ) * 100);

    return (
      <div className="min-h-screen bg-slate-50 p-6 lg:p-12 font-sans">
        <div className="max-w-4xl mx-auto bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
          <div className="bg-slate-800 text-white p-8 text-center">
            <h2 className="text-3xl font-bold mb-2">Exam Results</h2>
            <div className="text-5xl font-black text-blue-400 my-6">{percentage}%</div>
            <p className="text-slate-300 text-lg">You scored {score} out of {totalQ}</p>
          </div>
          
          <div className="p-8">
            <div className="flex justify-between items-center mb-6">
              <h3 className="text-xl font-bold text-slate-800">Detailed Review</h3>
              <button onClick={() => setMode('intro')} className="px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold rounded-lg transition flex items-center">
                <Home className="w-4 h-4 mr-2" /> Back to Home
              </button>
            </div>

            <div className="space-y-6">
              {quizData.map((q, i) => {
                const userAns = answers[i];
                const isCorrect = userAns === q.ans;
                const isUnanswered = userAns === null;

                return (
                  <div key={q.id} className={`p-4 rounded-lg border ${isCorrect ? 'bg-green-50 border-green-200' : isUnanswered ? 'bg-slate-50 border-slate-200' : 'bg-red-50 border-red-200'}`}>
                    <div className="flex items-start">
                      <div className="font-bold text-slate-500 w-8 flex-shrink-0">{q.id}.</div>
                      <div className="flex-1">
                        <p className="text-slate-800 font-medium mb-3">{q.q}</p>
                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm">
                          <div className="flex items-center">
                            <span className="text-slate-500 w-24">Your Answer:</span>
                            <span className={`font-semibold ${isCorrect ? 'text-green-700' : 'text-red-700'}`}>
                              {isUnanswered ? 'None' : q.opts[userAns]}
                            </span>
                          </div>
                          {!isCorrect && (
                            <div className="flex items-center">
                              <span className="text-slate-500 w-24">Correct:</span>
                              <span className="font-semibold text-green-700">{q.opts[q.ans]}</span>
                            </div>
                          )}
                        </div>
                      </div>
                      <div className="ml-4 flex-shrink-0">
                        {isCorrect ? <CheckCircle className="text-green-500 w-6 h-6" /> : <X className="text-red-500 w-6 h-6" />}
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      </div>
    );
  }

  // Quiz Interface (Practice & Exam)
  return (
    <div className="min-h-screen bg-slate-100 flex flex-col font-sans">
      {/* Navbar */}
      <header className="bg-slate-800 text-white shadow-md z-10">
        <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
          <div className="flex items-center">
            <button onClick={() => setSidebarOpen(!sidebarOpen)} className="p-2 mr-2 hover:bg-slate-700 rounded-lg lg:hidden">
              <Menu className="w-5 h-5" />
            </button>
            <button onClick={goHome} className="p-2 mr-2 hover:bg-slate-700 rounded-lg hidden sm:block" title="Back to Home">
              <Home className="w-5 h-5" />
            </button>
            <h1 className="font-bold tracking-wide truncate">Structural Analysis & Design</h1>
            <span className="ml-4 px-2.5 py-0.5 rounded-full text-xs font-semibold uppercase tracking-wider bg-slate-700 text-blue-300 hidden sm:inline-block">
              {isPractice ? 'Practice' : 'Exam'} Mode
            </span>
          </div>
          <div className="flex items-center space-x-4">
            <div className="text-sm font-medium text-slate-300">
              {answeredCount} / {totalQ} Answered
            </div>
            <button 
              onClick={submitExam}
              className="bg-blue-600 hover:bg-blue-500 text-white px-4 py-1.5 rounded text-sm font-semibold transition"
            >
              {isExam ? 'Submit' : 'Finish'}
            </button>
          </div>
        </div>
      </header>

      {/* Main Layout */}
      <div className="flex flex-1 overflow-hidden relative">
        
        {/* Sidebar Nav (Questions Grid) */}
        <aside className={`${sidebarOpen ? 'translate-x-0' : '-translate-x-full'} absolute lg:relative z-20 w-72 h-full bg-white border-r border-slate-200 shadow-xl lg:shadow-none transition-transform duration-300 overflow-y-auto flex-shrink-0`}>
          <div className="p-4 border-b border-slate-100 sticky top-0 bg-white/95 backdrop-blur z-10 flex justify-between items-center">
            <h2 className="font-bold text-slate-700">Questions</h2>
            <button onClick={() => setSidebarOpen(false)} className="lg:hidden p-1 text-slate-400 hover:bg-slate-100 rounded">
              <X className="w-5 h-5" />
            </button>
          </div>
          <div className="p-4 grid grid-cols-4 gap-2">
            {quizData.map((q, i) => {
              const isCurrent = i === currentIdx;
              const hasAnswered = answers[i] !== null;
              const isCorrect = hasAnswered && answers[i] === q.ans;
              
              let btnStyle = "bg-slate-50 text-slate-600 border border-slate-200 hover:bg-slate-100";
              
              if (isCurrent) {
                btnStyle = "bg-blue-100 text-blue-800 border-blue-400 font-bold ring-2 ring-blue-400 ring-offset-1";
              } else if (hasAnswered) {
                if (isPractice) {
                  btnStyle = isCorrect ? "bg-green-100 text-green-800 border-green-300" : "bg-red-100 text-red-800 border-red-300";
                } else {
                  btnStyle = "bg-slate-700 text-white border-slate-700";
                }
              }

              return (
                <button
                  key={q.id}
                  onClick={() => setCurrentIdx(i)}
                  className={`w-12 h-12 flex items-center justify-center rounded-lg text-sm transition-all ${btnStyle}`}
                >
                  {q.id}
                </button>
              );
            })}
          </div>
        </aside>

        {/* Question Area */}
        <main className="flex-1 overflow-y-auto p-4 md:p-8 bg-slate-50 flex flex-col items-center">
          <div className="w-full max-w-3xl">
            
            {/* Situation Box */}
            {currentQ.sit && (
              <div className="mb-6 bg-yellow-50/50 border border-yellow-200 p-5 rounded-xl flex items-start">
                <AlertCircle className="w-5 h-5 text-yellow-600 mr-3 mt-0.5 flex-shrink-0" />
                <p className="text-sm text-yellow-800 leading-relaxed font-serif">
                  {currentQ.sit}
                </p>
              </div>
            )}

            {/* Question Box */}
            <div className="bg-white p-6 md:p-8 rounded-2xl shadow-sm border border-slate-200 mb-8">
              <div className="flex items-center text-slate-400 font-semibold mb-4 text-sm tracking-widest uppercase">
                Question {currentIdx + 1} of {totalQ}
              </div>
              <h2 className="text-xl md:text-2xl font-medium text-slate-800 leading-snug mb-8">
                {currentQ.q}
              </h2>

              {/* Options */}
              <div className="space-y-3">
                {currentQ.opts.map((opt, optIdx) => {
                  const isSelected = answers[currentIdx] === optIdx;
                  const hasAnswered = answers[currentIdx] !== null;
                  const isCorrectAns = currentQ.ans === optIdx;

                  let optClass = "w-full text-left p-4 rounded-xl border-2 transition-all duration-200 flex items-center justify-between ";
                  
                  if (isPractice && hasAnswered) {
                    if (isCorrectAns) {
                      optClass += "bg-green-50 border-green-500 text-green-900 shadow-sm";
                    } else if (isSelected) {
                      optClass += "bg-red-50 border-red-400 text-red-900";
                    } else {
                      optClass += "border-slate-100 bg-white text-slate-400 opacity-60";
                    }
                  } else {
                    if (isSelected) {
                      optClass += "bg-blue-50 border-blue-500 text-blue-900 shadow-sm";
                    } else {
                      optClass += "bg-white border-slate-200 text-slate-700 hover:border-slate-300 hover:bg-slate-50";
                    }
                  }

                  return (
                    <button
                      key={optIdx}
                      onClick={() => handleOptionClick(optIdx)}
                      disabled={isPractice && hasAnswered}
                      className={optClass}
                    >
                      <div className="flex items-center">
                        <span className={`w-8 h-8 flex items-center justify-center rounded-lg mr-4 font-bold text-sm ${
                          (isPractice && hasAnswered && isCorrectAns) ? 'bg-green-200 text-green-800' : 
                          (isPractice && hasAnswered && isSelected) ? 'bg-red-200 text-red-800' : 
                          isSelected ? 'bg-blue-200 text-blue-800' : 'bg-slate-100 text-slate-500'
                        }`}>
                          {String.fromCharCode(65 + optIdx)}
                        </span>
                        <span className="text-lg">{opt}</span>
                      </div>
                      
                      {isPractice && hasAnswered && isCorrectAns && <Check className="w-5 h-5 text-green-600" />}
                      {isPractice && hasAnswered && isSelected && !isCorrectAns && <X className="w-5 h-5 text-red-500" />}
                    </button>
                  );
                })}
              </div>
            </div>

            {/* Navigation Controls */}
            <div className="flex justify-between items-center bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
              <button
                onClick={() => setCurrentIdx(Math.max(0, currentIdx - 1))}
                disabled={currentIdx === 0}
                className="flex items-center px-4 py-2 text-slate-600 font-semibold disabled:opacity-30 hover:bg-slate-100 rounded-lg transition"
              >
                <ChevronLeft className="w-5 h-5 mr-1" /> Previous
              </button>
              
              {currentIdx === totalQ - 1 ? (
                <button
                  onClick={submitExam}
                  className="flex items-center px-6 py-2 bg-slate-800 text-white font-bold rounded-lg hover:bg-slate-700 transition"
                >
                  {isExam ? 'Submit Exam' : 'Finish Practice'}
                </button>
              ) : (
                <button
                  onClick={() => setCurrentIdx(Math.min(totalQ - 1, currentIdx + 1))}
                  disabled={currentIdx === totalQ - 1}
                  className="flex items-center px-4 py-2 text-slate-600 font-semibold disabled:opacity-30 hover:bg-slate-100 rounded-lg transition"
                >
                  Next <ChevronRight className="w-5 h-5 ml-1" />
                </button>
              )}
            </div>

          </div>
        </main>
      </div>
    </div>
  );
}